# Tema 2: Modelado estructural

## Entidades

### Tipo entidad

Concepto cuyos ejemplares son objetos __individuales__ o __identificables__ que existen en el dominio en un __momento determinado__. Los objetos son instancias de una o más entidades.

### Características

- __Nombre__  
  Sustantivo común singular (+ adjetivos)
- __Población__  
  El número de ejemplares de la entidad *E* que existen en el dominio en un instante *t*. Puede ser *variable*, *permanente* o *constante*.
- __Subtipado__
  Una entidad *E* es un subtipo de una entidad *F* si la población de *E* es subconjunto de la de *F*.

### Representación en UML

![](http://i.imgur.com/OaSXrJx.png)

- El estereotipo `<<type>>` indica un tipo entidad, independientemente de la representación.
- Una clase es la realización de un tipo entidad.
- Mujer es un subtipo de persona.
- Las llaves indican restricciones que se aplican a todos los ejemplares de la entidad.
- Las restricciones `{permanent}` y `{constant}` no son UML estándar.
- Los ejemplares se indican mediante `[nombre]:[Entidad]`

### Modelos de clasificación

- __Clasificación múltiple (vs. simple)__  
  Un objeto puede ser un ejemplar de varias entidades, sin que sean subtipo una de otra. UML es un lenguaje de clasificación múltiple.
- __Clasificación dinámica (vs. estática)__
  Un objeto puede cambiar, en momentos distintos, las entidades de las que es ejemplar. UML es un lenguaje de clasificación dinámica.

### Tipos de datos

- No se consideran objetos, sino literales.
- Predefinidos externamente a UML (`<<primitive>>`).  
  Ej. `boolean`, `integer`, `string`, `decimal`...
- No suelen representarse explícitamente.
- Pueden extenderse: *ISBN*, *URL*... (`<<dataType>>`).
- Pueden definirse tipos enumerados (`<<enumeration>>`)

## Relaciones

### Tipos relación

Concepto cuyos ejemplares son relaciones __individuales__ e __identificables__ entre objetos que existen en el dominio en un __momento determinado__.  
Cada participante juega un determinado papel o __rol__.

### Nombre y enunciado

- __Nombre__  
  Verbo en tercera persona del singular (+ preposiciones).  
  No es obligatorio, puede ser sustituido por los nombres de rol.
- __Forma lógica__  
  relación(rol<sub>1</sub>:Entidad<sub>1</sub>, ..., rol<sub>n</sub>:Entidad<sub>n</sub>)  
  Ejemplo: `lee(lector:Persona, lectura:Libro)`
- __Forma contextual__
    - `<lector>` lee `<lectura>`
    - `<lector>` es el lector de `<lectura>`
    - `<lectura>` es la lectura de `<lector>`

### Características

- __Grado__  
  El número de participantes en la relación.  
  Binarias, ternarias, n-arias.
- __Población__ (en un instante `t`)  
  El número de ejemplares de la relación *E* que existen en el dominio en un instante *t*.
    - __Síncronas (vs. asíncronas)__: los objetos relacionados existen en el dominio en el instante *t*.
    - __Permanentes, constantes__: respecto a una entidad o a todas.

### Representación en UML

![](http://i.imgur.com/5TjjBSu.png)

- El nombre es opcional
    - Implícitamente indicado por los roles.
    - El símbolo `>` indica cómo leer el nombre.
- Los roles son opcionales
    - Implícitamente indicado por las entidades.
    - Las restricciones `constant` y `permanent` no son UML estándar.

### Relaciones n-arias

Se representan mediante un diamante:

![](http://i.imgur.com/hfN6Roc.png)

Las relaciones n-arias no son frecuente, pero en ocasiones son necesarias:

![](http://i.imgur.com/l69FBeK.png)

### Subtipado

Una relación *R* es un subtipo de una relación *S* si la población de *R* es un subconjunto de la de *S*.  
Las propiedades definitorias de *S* son un subconjunto de las propiedades de *R*.  
El subtipado de relaciones no es frecuente.

![](http://i.imgur.com/ysHYtUd.png)

### Enlaces

Los ejemplares de una relación se denominan __enlaces__. Conectan ejemplares concretos de __tipos entidad__.

![](http://i.imgur.com/ql9yEJs.png)

### Atributos

- Las entidades participantes en una relación están todas al mismo nivel. Ninguna puede ser considerada como predominante.
- En ocasiones un participante es una característica o está subordinado a otro. En este caso se modela como un atributo.
- Solo representaremos como atributos los __tipos de datos__.

## Multiplicidad

- Indica cuántos ejemplares de cada entidad pueden participar en un enlace de una relación. Restringe la población de los tipos entidad y juega un papel importante en el diseño del sistema.
- Notación:
    - Se define mediante un par de valores `min..max`.
    - En el extremo conectado a la entidad correspondiente.
    - Si ambos son iguales se representa solo uno de ellos.
    - Una multiplicidad indeterminada se representa mediante `*`.

Ejemplos:

- `0..1`: opcional
- `1`: simple
- `1..*`: obligatoria
- `*`: indeterminada

### Representación en UML

![](http://i.imgur.com/t61Y7rm.png)

### Multiplicidad en relaciones n-arias

![](http://i.imgur.com/NklmCYQ.png)

- Un programador utiliza un único lenguaje en un determinado proyecto.
- Un proyecto puede ser implementado por un número indeterminado de programadores en un determinado lenguaje.
- Un lenguaje puede ser utilizado por un determinado programador en un máximo de tres proyectos.

## Reificación

Consiste en __transformar una relación en una entidad__.  Es útil si hay atributos dependientes de la relación.

![](http://i.imgur.com/YnZK85A.png)

Pasa a:

![](http://i.imgur.com/rA7Y5Xe.png)

## Reificación de relaciones n-arias

![](http://i.imgur.com/4owHVn1.png)

Pasa a:

![](http://i.imgur.com/JeoWfrd.png)

## Dependencias

- Las dependencias se representan en UML mediante líneas punteadas direccionales.
    - Indican que una entidad tiene conocimiento de otra a pesar de no estar conectadas por ninguna relación.
    - Existen estereotipos estándar para representar algunas dependecias habituales.

![](http://i.imgur.com/gm5deyZ.png)

## Tipos derivados

- __Tipos base__.  
  Su población debe representarse explícitamente en el sistema.
- __Tipos derivados__.  
  Su población puede ser inferida a través de otros tipos.
- __Regla de derivación__.  
  Define las condiciones necesarias y suficientes para ser ejemplar de un tipo derivado. Puede representarse en lenguaje natural o en *OCL*.

Pueden aparecer como derivados: __tipos entidad__, __tipos relación__, __roles__, __atributos__...  
Las reglas de derivación pueden aparecer como restricciones o en comentarios.

### Ejemplos

- Cuatrilátero, derivada de Polígono y { lados = 4 }
- Hombre, derivada de Persona y { género = masculino }
- Persona, derivada de Hombre y Mujer

![](http://i.imgur.com/equwEV1.png)

## Relaciones especiales: composición y agregación

- Son relaciones que aparecen con frecuencia al modelar.
    - Representan una relación genérica entre un todo y sus partes.  
      `esParteDe(parte:Entidad, todo:Entidad)`.
    - Se realizan instanciándolas con entidades del modelo.  
      `capituloEsParteDelLibro(parte:Capitulo, todo:Libro)`.
    - Tienen propiedades y restricciones particulares.  
        - Antisimétrica, transitiva, exclusividad de las partes, existencia de las partes.
    - UML dispone de construcciones específicas para representarlas:  
      ![](http://i.imgur.com/mLt7v2S.png)

![](http://i.imgur.com/QoWzfV0.png)

- La composición implica *exclusividad total* de las partes.
    - La multiplicidad máxima en el rol *todo* es 1 (ej. *una línea solo puede formar parte de un único servicio de bus, ya sea urbano o regional*).
- La agregación permite *compartición* de partes.
    - La multiplicidad `(min..max)` en el rol *todo* no está restringida (ej. *paradas y segmentos pueden estar compartidos entre varias líneas*).

## Relaciones especiales: agrupamiento / membresía

- Representa la relación entre un grupo y sus miembros.  
  `esMiembroDe(miembro:Entidad, grupo:Entidad)`.
- Propiedades (diferencias con *composición* y *agregación*):
    - Todos los miembros de un grupo juegan el mismo papel en éste.
    - Los miembros son independientes de los grupos.
    - Los miembros pueden ser compartidos entre diferentes grupos.
    - No es transitiva.
- No está definida en UML estándar.  
  Podemos definirla mediante un estereotipo:  
  `<<isMemberOf>>`.

### Ejemplo

![](http://i.imgur.com/sBetKN4.png)

- __Una escuela__ se compone de, al menos, una clase y un número indeterminado de equipos deportivos.
- __Un alumno__ es miembro de una única clase y puede serlo de varios equipos.

## Relaciones especiales: especialización / generalización

- Modela la relación entre un tipo entidad y sus subtipos.
    - Un ejemplar del subtipo es un ejemplar del tipo:  
      `esUn(subtipo:Entidad, supertipo:Entidad)`.
    - Permite representar la especialización o la generalización.
    - Construye taxonomías con las entidades del modelo.  
      ![](http://i.imgur.com/Zb9qf1C.png)
    - La especialización implica un *refinamiento* del supertipo:
        - Los subtipos heredan las propiedades (atributos, relaciones) del supertipo.
        - Añaden nuevas propiedades y restricciones.

### Especialización: disjunta y completa

![](http://i.imgur.com/gWBJB8X.png)

- Especialización disjunta vs. solapada.  
  Los subtipos no tienen ejemplares en común.
- Especialización completa vs. incompleta.  
  Todo ejemplar del supertipo es ejemplar de alguno de los subtipos.
- `género` es una propiedad *discriminante*.  
  Permite clasificar los ejemplares en un subtipo u otro.

### Especialización: dimensiones

- Una entidad puede especializarse de acuerdo a diferentes dimensiones o criterios.
    - Sus ejemplares pueden serlo de varios subtipos al mismo tiempo.
    - Si la clasificación es dinámica (*no permanente*) es más adecuado utilizar relaciones de __rol__.

![](http://i.imgur.com/EUWMPCP.png)

### Especialización: múltiple

- Una entidad puede ser subtipo de varias:  
  Hereda las propiedades de cada uno de sus supertipos.

![](http://i.imgur.com/4iAfjsz.png)

Ejemplo: `cuadrado` es un subtipo derivado cuya población es la intersección de las de `rectangulo` y `rombo`.

### Especialización: refinamiento de relaciones

- La especialización puede implicar el refinamiento de relaciones con otras entidades del modelo.

![](http://i.imgur.com/PDNJrpE.png)

Ejemplo: solo los `atletas masculinos` (resp. `femeninos`) pueden participar en `pruebas masculinas` (resp. `femeninas`).

### Especialización: refinamiento de multiplicidad

- El refinamiento también puede afectar a la multiplicidad de las relaciones.

![](http://i.imgur.com/9Xj21lW.png)

Ejemplo: una `bicicleta` es un `vehiculo` que puede transportar un máximo de dos `personas` (pasajeros).

### Especialización: refinamiento de propiedades

- En general, el refinamiento puede afectar a cualquier propiedad de una entidad.

![](http://i.imgur.com/MDD9fw6.png)

## Relaciones especiales: roles

Definición:

1. Nombre que se le da a un participante en una relación.  
  Cada participante juega un rol determinado en una relación.
1. Situación (temporal) en que los ejemplares de una entidad pueden encontrarse en un momento dado.  
  Ejemplo: `ser alumno` es un rol de `persona`.

- El concepto de rol surge frecuentemente en el modelado.  
  Existen dos estrategias para implementarlo:
    - Subtipado.
    - Subrogación (sustitución).

### Ejemplo

Consideremos las relaciones entre `persona` y `curso`:

![](http://i.imgur.com/mEUFIak.png)

- Una `persona` puede jugar el papel de `organizador`, `docente` o `alumno` respecto a un `curso`.
- Dependiendo del papel que juegue, tendrá propiedades distintas:
    - El organizador deberá seleccionar a los docentes.
    - Los docentes deberán preparar contenidos y pruebas.
    - Los alumnos deberás realizar las pruebas.

### Roles por subtipado

![](http://i.imgur.com/cIhO7id.png)

- UML admite clasificación múltiple y dinámica.  
  Pero muchos lenguajes orientados a objetos no.  
  Una misma `persona` no puede jugar varios roles o cambiar de rol.

### Roles por subrogación

![](http://i.imgur.com/bo5ma48.png)

- Hemos realizado un proceso de reificación.  
  Transformando los roles en entidades, podemos asignar múltiples roles a las personas de manera dinámica.

- Representa la relación de *jugar un papel de*.  
  `juegaPapelDe(rol:Entidad, jugador:Entidad)`.
- Propiedades (diferencias con composición y agregación):
    - Una misma entidad jugador puede jugar varios roles.
    - Una misma entidad rol no puede serlo de más de un jugador.
    - La entidad rol es dependiente de la entidad jugador:
        - `jugador` es constante respecto a `rol`.
        - Si desaparece el `jugador`, desaparece el `rol`.
- No está definida en UML estándar.  
  Podemos definirla mediante un estereotipo:  
  `<<esRoleOf>>`.

## Relaciones especiales: materialización

- Representa la relación entre un modelo y sus realizaciones concretas o materializaciones.  
  El modelo es una abstracción, especificación o tipo de la materialización.  
  `materializa(materializacion:Entidad, modelo:Entidad)`.
- Propiedades:
    - Antisimétrica y transitiva.
    - Una materialización dada materializa un único modelo.
    - Un modelo puede materializarse en muchas materializaciones.
    - El modelo es constante respecto a la materialización.
    - La materialización __hereda__ propiedades del modelo.

Ejemplo: `produccionMaterializaObra(materializacion:Produccion, modelo:ObraTeatral)`.  
Las propiedades heredades se definen como derivadas (*/*).

![](http://i.imgur.com/035B1Sx.png)

## Diagramas de clases

Un diagrama de clases es la representación gráfica del modelo estructural de un sistema.

- Proporciona una visión estática del mismo.
    - No incluye información temporal (cómo evoluciona el sistema).
- Representa los tipos entidad y relación relevantes en el dominio.
    - Detalla sus características y propiedades (ej. *atributos*) y sus restricciones (ej. *de multiplicidad y otras*).
- Muestra de manera abstracta las relaciones potenciales que los ejemplares de las entidades mantienen unos con otros.
- El modelo de un sistema puede incluir varios diagramas de clases.
    - Cada uno da una visión parcial del modelo.
    - Una entidad puede aparecer varias veces en el mismo o distintos diagramas.
    - Las entidades repetidas son la misma, identificadas por su nombre.

## Diagramas de objetos

Un diagrama de objetos muestra objetos y enlaces entre éstos.

- Visión parcial del estado del dominio en un momento determinado.
    - Sirven para mostrar situaciones concretas, tales como ejemplos o escenarios del sistema.
- Tienen que ser consistentes con los diagramas de clases.
    - Los objetos son ejemplares de algún tipo entidad.
    - Los ejemplares son enlaces de algún tipo relación (excepto las de especialización).
    - Deben cumplir las restricciones de multiplicidad y otras.
- Pueden detallar los valores de los atributos de los objetos representados.
